(function(e){"function"==typeof bootstrap?bootstrap("promise",e):"object"==typeof exports?e(void 0,exports):"function"==typeof define?define(e):"undefined"!=typeof ses?ses.ok()&&(ses.makeQ=function(){return e(void 0,{})}):e(void 0,Q={})})(function(e,t){function n(e){var t=Error.prepareStackTrace;return Error.prepareStackTrace=function(e,t){return t.filter(function(e){var t=e.getFileName(),n;if(n="module.js"!==t)if(n="node.js"!==t)t!==T?e=!1:(e=e.getLineNumber(),e=e>=x&&e<=X),n=!e;return n})},e=e.stack,Error.prepareStackTrace=t,e}function r(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,r){e=r[1].getFileName(),t=r[1].getLineNumber()},Error().stack,Error.prepareStackTrace=n,T=e,t}}function i(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",Error("").stack),e.apply(e,arguments)}}function s(){function e(e){if(t)return n=h(e),D(t,function(e,t){k(function(){n.promiseSend.apply(n,t)})},void 0),t=void 0,n}var t=[],n,r=B(s.prototype),i=B(o.prototype);return i.promiseSend=function(){var e=_(arguments);t?t.push(e):k(function(){n.promiseSend.apply(n,e)})},i.valueOf=function(){return t?i:n.valueOf()},Error.captureStackTrace&&Error.captureStackTrace(i,s),C(i),r.promise=i,r.resolve=e,r.reject=function(t){return e(c(t))},r}function o(e,t,n,r){void 0===t&&(t=function(e){return c(Error("Promise does not support operation: "+e))});var i=B(o.prototype);return i.promiseSend=function(n,r){var s=_(arguments,2),o;try{o=e[n]?e[n].apply(i,s):t.apply(i,[n].concat(s))}catch(u){o=c(u)}r(o)},n&&(i.valueOf=n),r&&(i.exception=r),C(i),i}function u(e){return Object(e)!==e?e:e.valueOf()}function a(e){return e&&"function"==typeof e.promiseSend}function f(e){return!a(u(e))}function l(e){return e=u(e),a(e)&&"exception"in e}function c(e){var e=e||Error(),t=o({when:function(t){if(t){var n=P(q,this);-1!==n&&(R.splice(n,1),q.splice(n,1))}return t?t(e):c(e)}},function(){return c(e)},function(){return this},e);return q.push(t),R.push(e),t}function h(e){if(a(e))return e;if(e&&"function"==typeof e.then){var t=s();return e.then(t.resolve,t.reject),t.promise}return o({when:function(){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n},del:function(t){return delete e[t]},post:function(t,n){return e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},fapply:function(t){return e.apply(void 0,t)},viewInfo:function(){function t(e){r[e]||(r[e]=typeof n[e])}for(var n=e,r={};n;)Object.getOwnPropertyNames(n).forEach(t),n=Object.getPrototypeOf(n);return{type:typeof e,properties:r}},keys:function(){return j(e)}},void 0,function(){return e})}function p(e,t){return e=h(e),t?o({viewInfo:function(){return t}},function(){var t=_(arguments);return m.apply(void 0,[e].concat(t))},function(){return u(e)}):m(e,"viewInfo")}function d(e,t,n){function r(e){try{return t?t(e):e}catch(n){return c(n)}}function i(e){try{return n?n(e):c(e)}catch(t){return c(t)}}var o=s(),u=!1;return k(function(){h(e).promiseSend("when",function(e){u||(u=!0,o.resolve(r(e)))},function(e){u||(u=!0,o.resolve(i(e)))})}),o.promise}function v(e){return function(t){var n=_(arguments,1);return m.apply(void 0,[t,e].concat(n))}}function m(e,t){var n=s(),r=_(arguments,2),e=h(e);return k(function(){e.promiseSend.apply(e,[t,n.resolve].concat(r))}),n.promise}function g(e,t,n){var r=s(),e=h(e);return k(function(){e.promiseSend.apply(e,[t,r.resolve].concat(n))}),r.promise}function y(e){return function(t){var n=_(arguments,1);return g(t,e,n)}}function b(e){var t=_(arguments,1);return W(e,t)}function w(e){return d(e,function(e){var t=e.length;if(0===t)return h(e);var n=s();return D(e,function(r,i,s){f(i)?(e[s]=u(i),0===--t&&n.resolve(e)):d(i,function(r){e[s]=r,0===--t&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function E(e,t,n){return S(e,t).apply(void 0,n)}function S(e){if(1<arguments.length)var t=arguments[1],n=_(arguments,2),r=e,e=function(){var e=n.concat(_(arguments));return r.apply(t,e)};return function(){var t=s(),n=_(arguments);return n.push(t.makeNodeResolver()),W(e,n).fail(t.reject),t.promise}}var x=r(),T,N=function(){},C=Object.freeze||N;"undefined"!=typeof cajaVM&&(C=cajaVM.def);var k;if("undefined"!=typeof process)k=process.nextTick;else if("function"==typeof msSetImmediate)k=msSetImmediate.bind(window);else if("function"==typeof setImmediate)k=setImmediate;else if("undefined"!=typeof MessageChannel){var L=new MessageChannel,A={},O=A;L.port1.onmessage=function(){A=A.next;var e=A.task;delete A.task,e()},k=function(e){O=O.next={task:e},L.port2.postMessage(0)}}else k=function(e){setTimeout(e,0)};var M;Function.prototype.bind?(M=Function.prototype.bind,M=M.bind(M.call)):M=function(e){return function(){return e.call.apply(e,arguments)}};var _=M(Array.prototype.slice),D=M(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),P=M(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),H=M(Array.prototype.map||function(e,t){var n=this,r=[];return D(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),B=Object.create||function(e){function t(){}return t.prototype=e,new t},j=Object.keys||function(e){var t=[],n;for(n in e)t.push(n);return t},F=Object.prototype.toString,I;I="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},t.nextTick=k,t.defer=s,s.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(_(arguments,1)):e.resolve(n)}},s.prototype.node=i(s.prototype.makeNodeResolver,"node","makeNodeResolver"),t.promise=function(e){var t=s();return b(e,t.resolve,t.reject).fail(t.reject),t.promise},t.makePromise=o,o.prototype.then=function(e,t){return d(this,e,t)},D("isResolved,isFulfilled,isRejected,when,spread,send,get,put,del,post,invoke,keys,apply,call,bind,fapply,fcall,fbind,all,allResolved,view,viewInfo,timeout,delay,catch,finally,fail,fin,end".split(","),function(e,n){o.prototype[n]=function(){return t[n].apply(t,[this].concat(_(arguments)))}},void 0),o.prototype.toSource=function(){return this.toString()},o.prototype.toString=function(){return"[object Promise]"},C(o.prototype),t.nearer=u,t.isPromise=a,t.isResolved=function(e){return f(e)||l(e)},t.isFulfilled=f,t.isRejected=l;var q=[],R=[];"undefined"!=typeof window&&window.console&&console.log("Should be empty:",R),t.reject=c,t.begin=h,t.resolve=h,t.ref=i(h,"ref","resolve"),t.master=function(e){return o({isDef:function(){}},function(){var t=_(arguments);return m.apply(void 0,[e].concat(t))},function(){return u(e)})},t.viewInfo=p,t.view=function(e){return p(e).when(function(t){var n;n=t.type==="function"?function(){return z(e,void 0,arguments)}:{};var r=t.properties||{};return j(r).forEach(function(t){r[t]==="function"&&(n[t]=function(){return U(e,t,arguments)})}),h(n)})},t.when=d,t.spread=function(e,t,n){return d(e,function(e){return w(e).then(function(e){return t.apply(void 0,e)})},n)},t.async=function(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return F(o)==="[object StopIteration]"||o instanceof I?o.value:c(o)}return d(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}},t["return"]=function(e){throw new I(e)},t.promised=function(e){return function(){return w([this,w(arguments)]).spread(function(t,n){return e.apply(t,n)})}},t.sender=i(v,"sender","dispatcher"),t.Method=i(v,"Method","dispatcher"),t.send=i(m,"send","dispatch"),t.dispatch=g,t.dispatcher=y,t.get=y("get"),t.put=y("put"),t["delete"]=t.del=y("del");var U=t.post=y("post");t.invoke=function(e,t){var n=_(arguments,2);return U(e,t,n)};var z=t.apply=i(y("apply"),"apply","fapply"),W=t.fapply=y("fapply");t.call=i(function(e,t){var n=_(arguments,2);return z(e,t,n)},"call","fcall"),t["try"]=b,t.fcall=b,t.bind=i(function(e,t){var n=_(arguments,2);return function(){var r=n.concat(_(arguments));return z(e,t,r)}},"bind","fbind"),t.fbind=function(e){var t=_(arguments,1);return function(){var n=t.concat(_(arguments));return W(e,n)}},t.keys=y("keys"),t.all=w,t.allResolved=function(e){return d(e,function(e){return d(w(H(e,function(e){return d(e,N,N)})),function(){return H(e,h)})})},t["catch"]=t.fail=function(e,t){return d(e,void 0,t)},t["finally"]=t.fin=function(e,t){return d(e,function(e){return d(t(),function(){return e})},function(e){return d(t(),function(){return c(e)})})},t.end=function(e){d(e,void 0,function(t){k(function(){var r;if(Error.captureStackTrace&&typeof t=="object"&&(r=n(t))){var i=n(e);r=r.concat("From previous event:",i);var s,i=[];try{i.push(t.toString())}catch(o){try{i.push("<error: "+o+">")}catch(u){i.push("<error>")}}for(var a=0;a<r.length;a++){var f=r[a];if(typeof f=="string")i.push(f);else{try{var l="";if(f.isNative())l="native";else if(f.isEval())l="eval at "+f.getEvalOrigin();else{var c=f.getFileName();if(c){var l=l+c,h=f.getLineNumber();if(h!==null){var l=l+(":"+h),p=f.getColumnNumber();p&&(l+=":"+p)}}}l||(l="unknown source");var d="",v=f.getFunction().name,m=!0,g=f.isConstructor();if(!f.isToplevel()&&!g){var y=f.getMethodName(),d=d+(f.getTypeName()+".");v?(d+=v,y&&y!==v&&(d+=" [as "+y+"]")):d+=y||"<anonymous>"}else g?d+="new "+(v||"<anonymous>"):v?d+=v:(d+=l,m=!1);m&&(d+=" ("+l+")"),s=d}catch(b){try{s="<error: "+b+">"}catch(w){s="<error>"}}i.push("    at "+s)}}s=i.join("\n"),t.stack=s}throw t})})},t.timeout=function(e,t){var n=s(),r=setTimeout(function(){n.reject(Error("Timed out after "+t+" ms"))},t);return d(e,function(e){clearTimeout(r),n.resolve(e)},n.reject),n.promise},t.delay=function(e,t){t===void 0&&(t=e,e=void 0);var n=s();return setTimeout(function(){n.resolve(e)},t),n.promise},t.napply=E,t.ncall=function(e,t){var n=_(arguments,2);return E(e,t,n)},t.nbind=S,t.npost=function(e,t,n){return E(e[t],e,n)},t.ninvoke=function(e,t){var n=_(arguments,2);return E(e[t],e,n)},C(t);var X=r()});var Nakama={};Nakama.version="0.0.1",exports=module.exports=Nakama,Nakama.Ajax=function(e,t){if(typeof window=="undefined")var n=require("xmlhttprequest").XMLHttpRequest;var r=new n;r.onreadystatechange=function(){r.readyState==4&&r.status==200&&typeof t=="function"&&t(r)},r.open("GET",e.url,!0),r.send()},Nakama.Config=function(e){e=e||{},this.debug=e.debug||!1,this.url=e.url||"http://107.20.202.100:8080/nakama"},Nakama.Config.url="http://107.20.202.100:8080/nakama",Nakama.Debug=function(e){this.Config.debug===!0&&console.log("Nakama.js Error: "+e)},Nakama.App=function(e){Nakama.Config(e)},Nakama.Photo=function(e,t){var n=this,r=arguments.length;e=e||{};if(!e.id){n.Debug("Please supply a photo ID.");return}if(!i)var i=require("q");var s=i.defer();return Nakama.Ajax({url:Nakama.Config.url+"/photo/list/"+e.id},function(e){r===2?typeof t=="function"&&t(e.responseText):s.resolve(e.responseText)}),s.promise}